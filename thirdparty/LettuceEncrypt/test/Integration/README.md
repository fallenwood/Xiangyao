Integration Testing
===================

This project doesn't yet have automated tests for integration, so here is how to manually test.

## Testing in development using ngrok

To test this project, I recommend the following steps.

1. Download and install [ngrok](https://ngrok.io), a command-line tool for creating a publically accessible tunnel to your computer.

2. Start `ngrok v2` by running `ngrok http -bind-tls=false 5000` or `ngrok v3` by `ngrok http --scheme=http 5000`. This will create a temporary, public URL `http://TMP.ngrok.io`

![ngrok](https://i.imgur.com/Vl8Egsv.png)

3. Edit your hosts file to redirect http://TMP.ngrok.io to localhost
    ```
    sudo vim /etc/hosts
    ```

    Add a new line for "127.0.0.1  TMP.ngrok.io"

![vim](https://i.imgur.com/BtJQSaL.png)

4. Set your app to use Let's Encrypt staging environment so you don't hit rate limits in generating certificates.

```csharp
    services.AddLettuceEncrypt(o =>
    {
        o.DomainNames = new[] { "TMP.ngrok.io" };
        o.UseStagingServer = true; // <--- use staging

        o.AcceptTermsOfService = true;
        o.EmailAddress = "admin@example.com";
    });
```

5. `dotnet run` your application.

![run](https://i.imgur.com/eXqCKBL.png)

And voila! The API should automatically provision and create an HTTPs certificate for TMP.ngrok.io.

## Testing Azure KeyVault

Removed support for this, please refer to original repo.

## Trusting test certs

By default, certificates generated by Let's Encrypt's staging certificates will not appear as a trusted certificate.

![red-hazard](https://i.imgur.com/vnoqhCq.png)

To trust a test certificate, on macOS

1. Open up "Keychain Access" and search for your certificate.

![keychain](https://i.imgur.com/w6BZvyN.png)

2. Right click on the certificate on click "Get Info"

![get-info](https://i.imgur.com/EL4fJAm.png)

3. Under the "Trust" section, change the drop-down to "Trust" and **close the info window**. This should prompt you for a password.

![trust-it](https://i.imgur.com/JmQnglg.png)

4. Refresh your browser.

![green](https://i.imgur.com/tyTaJwV.png)
